timer milliseconds done {
    (printf "Sleeping for `%lu ms`\n" milliseconds)
    (sleep milliseconds)
    (send done milliseconds)
}

iter c n {
    if (= n 0) {
        0
    } else {
        (printf " . %d\n" (receive c))
        (iter c (- n 1))
    }
}

main {
    let done {
        (channel)
    }

    (spawn timer 500  done)
    (spawn timer 1000 done)
    (spawn timer 750  done)
    (spawn timer 10   done)

    (iter done 4)

    (printf "Done!\n")
}
